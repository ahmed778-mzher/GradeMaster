<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Cairo -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #1e293b; /* slate-800 */
            color: #f1f5f9; /* slate-100 */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; /* slate-900 */
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; /* slate-600 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* slate-500 */
        }
        /* Custom styles for the switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 200px;
            height: 44px;
        }
        .switch .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #334155;
            transition: .4s;
            border-radius: 44px;
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 10px;
            font-weight: bold;
            color: #94a3b8;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 36px;
            width: 96px;
            left: 4px;
            bottom: 4px;
            background-color: #0ea5e9; /* sky-500 */
            transition: .4s;
            border-radius: 30px;
            z-index: 0;
        }
        .slider span {
            z-index: 1;
            transition: color .4s;
        }
        .slider .active {
            color: white;
        }
        #system-switch:checked + .slider:before {
            transform: translateX(96px);
        }
        /* Animation keyframes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.9); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        .animate-fade-out {
            animation: fadeOut 0.3s ease-in forwards;
        }
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        /* Custom Radio Button */
        input[type="radio"]:checked + label {
            background-color: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
        }
        /* Tooltip Styles */
        #tooltip {
            position: absolute;
            background-color: #334155;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            max-width: 250px;
            text-align: center;
        }
        #tooltip.visible {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="min-h-screen flex flex-col items-center justify-start p-4 pt-10">
        
        <!-- Main Application Container -->
        <div class="w-full max-w-lg md:max-w-2xl bg-slate-900 rounded-2xl shadow-2xl overflow-hidden flex flex-col p-6 sm:p-8">

            <!-- ===== Header ===== -->
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-white">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„</h1>
                <p id="system-subtitle" class="text-sky-400 font-semibold mt-1">Ù†Ø¸Ø§Ù… Ø¨ÙˆÙ„ÙˆÙ†ÙŠØ§</p>
            </div>

            <!-- ===== System Switch ===== -->
            <div class="mb-8 flex justify-center">
                <label class="switch">
                    <input type="checkbox" id="system-switch" class="hidden">
                    <div class="slider">
                        <span id="courses-label">Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</span>
                        <span id="bologna-label" class="active">Ø¨ÙˆÙ„ÙˆÙ†ÙŠØ§</span>
                    </div>
                </label>
            </div>

            <!-- ===== Results Display ===== -->
            <div class="bg-slate-800/70 rounded-xl p-6 text-center mb-6">
                <div id="bologna-results">
                    <p class="text-slate-400 text-sm">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (GPA)</p>
                    <p id="gpa-bologna" class="text-6xl font-black text-sky-400 my-2">0.00</p>
                    <p id="grade-name-bologna" class="text-xl font-bold text-slate-200">Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</p>
                    <p id="total-ects" class="text-slate-400 text-sm mt-4">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª: 0</p>
                </div>
                <div id="courses-results" class="hidden">
                     <p class="text-slate-400 text-sm">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p>
                    <p id="gpa-courses" class="text-6xl font-black text-sky-400 my-2">0.00</p>
                    <p id="grade-name-courses" class="text-xl font-bold text-slate-200">Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</p>
                </div>
            </div>

            <!-- ===== Calculation Mode Options (for Courses System) ===== -->
            <div id="courses-options" class="hidden mb-6">
                <p class="text-center font-bold text-slate-300 mb-3">Ø¯Ù‚Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</p>
                <div class="flex justify-center gap-2">
                    <input type="radio" name="calc-mode" id="mode-high" value="high" class="hidden">
                    <label for="mode-high" data-tooltip="high" class="cursor-pointer py-2 px-4 rounded-lg text-sm border border-slate-600 transition">Ù‚ÙŠÙ… Ø¹Ù„ÙŠØ§</label>
                    
                    <input type="radio" name="calc-mode" id="mode-median" value="median" class="hidden" checked>
                    <label for="mode-median" data-tooltip="median" class="cursor-pointer py-2 px-4 rounded-lg text-sm border border-slate-600 transition">Ù‚ÙŠÙ… ÙˆØ³Ø·ÙŠØ©</label>
                    
                    <input type="radio" name="calc-mode" id="mode-low" value="low" class="hidden">
                    <label for="mode-low" data-tooltip="low" class="cursor-pointer py-2 px-4 rounded-lg text-sm border border-slate-600 transition">Ù‚ÙŠÙ… Ø¯Ù†ÙŠØ§</label>
                </div>
            </div>
            
            <!-- ===== Action Buttons ===== -->
            <div class="space-y-3 mb-6">
                <button id="calculate-btn" class="w-full bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">
                    âœ“ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„
                </button>
                <button id="print-btn" class="w-full bg-slate-700 hover:bg-slate-600 text-sky-300 font-bold py-3 px-4 rounded-lg transition flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                    Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button>
                <button id="clear-btn" class="w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 px-4 rounded-lg transition">
                    Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                </button>
            </div>

            <!-- ===== Course List ===== -->
            <div class="border-t border-slate-700 pt-6">
                 <button id="add-course-btn" class="w-full bg-slate-700/50 hover:bg-slate-700 text-sky-400 font-bold py-3 px-4 rounded-lg mb-4 transition-transform transform hover:scale-105">
                    + Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
                <div id="courses-container" class="w-full space-y-3 max-h-[30vh] overflow-y-auto pr-2">
                    <!-- Course rows will be inserted here by JavaScript -->
                </div>
            </div>
            
            <!-- ===== Footer ===== -->
            <div class="w-full flex flex-col sm:flex-row justify-between items-center text-center mt-auto pt-6">
                 <div class="flex gap-4 mb-2 sm:mb-0">
                    <a href="https://github.com/Ahmed778-Mzher" target="_blank" class="text-slate-500 hover:text-sky-400 transition">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.91 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                    </a>
                    <a href="https://www.instagram.com/st_at_23" target="_blank" class="text-slate-500 hover:text-sky-400 transition">
                       <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 1.366.062 2.633.334 3.608 1.308.974.974 1.246 2.241 1.308 3.608.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.062 1.366-.334 2.633-1.308 3.608-.974.974-2.241 1.246-3.608 1.308-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.366-.062-2.633-.334-3.608-1.308-.974-.974-1.246-2.241-1.308-3.608C2.175 15.647 2.163 15.267 2.163 12s.012-3.584.07-4.85c.062-1.366.334-2.633 1.308-3.608.974-.974 2.241 1.246 3.608-1.308C8.416 2.175 8.796 2.163 12 2.163zm0-2.163C8.741 0 8.332.013 7.052.072 5.775.13 4.602.402 3.635 1.37 2.668 2.337 2.396 3.51 2.338 4.788.013 8.332 0 8.741 0 12c0 3.259.013 3.668.072 4.948.058 1.277.33 2.45 1.297 3.417.967.967 2.14 1.239 3.417 1.297C8.332 23.987 8.741 24 12 24s3.668-.013 4.948-.072c1.277-.058 2.45-.33 3.417-1.297.967-.967 1.239-2.14 1.297-3.417.059-1.28.072-1.689.072-4.948s-.013-3.668-.072-4.948c-.058-1.277-.33-2.45-1.297-3.417-.967-.967-2.14-1.239-3.417-1.297C15.668.013 15.259 0 12 0zm0 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zm0 10.162a3.999 3.999 0 1 1 0-7.998 3.999 3.999 0 0 1 0 7.998zm6.406-11.845a1.44 1.44 0 1 0 0 2.881 1.44 1.44 0 0 0 0-2.881z"/></svg>
                    </a>
                 </div>
                <a href="https://ahmed778-mzher.github.io/Ahmed/" target="_blank" class="text-xs text-slate-500 hover:text-sky-400">Ø¨Ø±Ù…Ø¬Ø©: Ahmed S.Jabbar</a>
            </div>

        </div>
    </div>

    <!-- ===== Print Modal ===== -->
    <div id="print-modal" class="modal-overlay fixed inset-0 bg-black/60 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-sm text-center animate-fade-in">
            <h2 class="text-xl font-bold mb-4">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h2>
            <p class="text-slate-400 mb-4">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ±.</p>
            <div class="space-y-3">
                <input type="text" id="university-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" class="w-full bg-slate-700 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500">
                <input type="text" id="college-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒÙ„ÙŠØ© ÙˆØ§Ù„Ù‚Ø³Ù…" class="w-full bg-slate-700 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500">
                <input type="text" id="student-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full bg-slate-700 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500">
            </div>
            <div class="flex gap-4 mt-6">
                <button id="proceed-print-btn" class="w-full bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 rounded-lg transition">Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©</button>
                <button id="cancel-print-btn" class="w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 rounded-lg transition">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
    
    <!-- ===== Tooltip Element ===== -->
    <div id="tooltip" class="hidden"></div>


    <script>
        // --- Telegram Bot Settings ---
        const TELEGRAM_BOT_TOKEN = "7113661131:AAEE-B80l73hR10X7xH3s_fXNqP5QeN-48Y";
        const TELEGRAM_CHAT_ID = "6348603611";

        // --- DOM Elements ---
        const app = {
            systemSwitch: document.getElementById('system-switch'),
            coursesContainer: document.getElementById('courses-container'),
            addBtn: document.getElementById('add-course-btn'),
            calculateBtn: document.getElementById('calculate-btn'),
            clearBtn: document.getElementById('clear-btn'),
            printBtn: document.getElementById('print-btn'),
            subtitle: document.getElementById('system-subtitle'),
            bolognaLabel: document.getElementById('bologna-label'),
            coursesLabel: document.getElementById('courses-label'),
            
            bolognaResults: document.getElementById('bologna-results'),
            coursesResults: document.getElementById('courses-results'),
            gpaBologna: document.getElementById('gpa-bologna'),
            gradeNameBologna: document.getElementById('grade-name-bologna'),
            totalEcts: document.getElementById('total-ects'),
            gpaCourses: document.getElementById('gpa-courses'),
            gradeNameCourses: document.getElementById('grade-name-courses'),
            
            printModal: document.getElementById('print-modal'),
            studentNameInput: document.getElementById('student-name-input'),
            universityNameInput: document.getElementById('university-name-input'),
            collegeNameInput: document.getElementById('college-name-input'),
            proceedPrintBtn: document.getElementById('proceed-print-btn'),
            cancelPrintBtn: document.getElementById('cancel-print-btn'),
            
            coursesOptions: document.getElementById('courses-options'),
            tooltip: document.getElementById('tooltip'),
            calcModeLabels: document.querySelectorAll('label[data-tooltip]')
        };

        // --- State ---
        let state = {
            isBologna: true
        };

        // --- Definitions ---
        const bolognaGradeTable = [
            { name: "Ø§Ù…ØªÙŠØ§Ø²", ects: "A", min: 90, max: 100 },
            { name: "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹", ects: "B", min: 80, max: 89 },
            { name: "Ø¬ÙŠØ¯", ects: "C", min: 70, max: 79 },
            { name: "Ù…ØªÙˆØ³Ø·", ects: "D", min: 60, max: 69 },
            { name: "Ù…Ù‚Ø¨ÙˆÙ„", ects: "E", min: 50, max: 59 },
            { name: "Ø±Ø³ÙˆØ¨", ects: "F", min: 0, max: 49 }
        ];
        const coursesGradeMappings = {
            low: { "Ø§Ù…ØªÙŠØ§Ø²": 90, "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹": 80, "Ø¬ÙŠØ¯": 70, "Ù…ØªÙˆØ³Ø·": 60, "Ù…Ù‚Ø¨ÙˆÙ„": 50, "Ù„Ø§ ÙŠÙˆØ¬Ø¯": 0 },
            median: { "Ø§Ù…ØªÙŠØ§Ø²": 95, "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹": 85, "Ø¬ÙŠØ¯": 75, "Ù…ØªÙˆØ³Ø·": 65, "Ù…Ù‚Ø¨ÙˆÙ„": 55, "Ù„Ø§ ÙŠÙˆØ¬Ø¯": 0 },
            high: { "Ø§Ù…ØªÙŠØ§Ø²": 100, "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹": 89, "Ø¬ÙŠØ¯": 79, "Ù…ØªÙˆØ³Ø·": 69, "Ù…Ù‚Ø¨ÙˆÙ„": 59, "Ù„Ø§ ÙŠÙˆØ¬Ø¯": 0 }
        };
        const tooltipTexts = {
            high: 'ÙŠØ­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø¨Ø§ÙØªØ±Ø§Ø¶ Ø­ØµÙˆÙ„Ùƒ Ø¹Ù„Ù‰ Ø£Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø© Ù…Ù…ÙƒÙ†Ø© Ù„ÙƒÙ„ ØªÙ‚Ø¯ÙŠØ± (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù…ØªÙŠØ§Ø² = 100). Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± ÙŠØ¹Ø·ÙŠ Ù†ØªÙŠØ¬Ø© Ù…ØªÙØ§Ø¦Ù„Ø©.',
            median: 'ÙŠØ­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© Ù„ÙƒÙ„ ØªÙ‚Ø¯ÙŠØ± (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù…ØªÙŠØ§Ø² = 95). Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙƒØ«Ø± ÙˆØ§Ù‚Ø¹ÙŠØ©.',
            low: 'ÙŠØ­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø¨Ø§ÙØªØ±Ø§Ø¶ Ø­ØµÙˆÙ„Ùƒ Ø¹Ù„Ù‰ Ø£Ù‚Ù„ Ø¯Ø±Ø¬Ø© Ù„Ù„Ù†Ø¬Ø§Ø­ ÙÙŠ ÙƒÙ„ ØªÙ‚Ø¯ÙŠØ± (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù…ØªÙŠØ§Ø² = 90). Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± ÙŠØ¹Ø·ÙŠ Ù†ØªÙŠØ¬Ø© Ù…ØªØ´Ø§Ø¦Ù…Ø©.'
        };


        // --- Functions ---

        function createCourseRow(id) {
            const courseDiv = document.createElement('div');
            courseDiv.id = `course-${id}`;
            courseDiv.className = 'bg-slate-800 p-3 rounded-lg flex items-center gap-2 transition-all animate-fade-in';
            
            const courseNumber = document.createElement('span');
            courseNumber.className = 'text-slate-400 font-bold text-sm';
            courseNumber.textContent = `Ù…Ø§Ø¯Ø© ${id}`;
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'text-red-400 hover:text-red-500 font-bold text-xl transition mr-auto';
            removeBtn.textContent = 'âœ•';
            removeBtn.onclick = () => {
                courseDiv.style.animation = 'fadeOut 0.3s ease-out forwards';
                setTimeout(() => {
                    courseDiv.remove();
                    updateCourseNumbers();
                }, 300);
            };

            const inputsContainer = document.createElement('div');
            inputsContainer.className = 'flex-grow flex items-center gap-2 justify-end';

            if (state.isBologna) {
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.placeholder = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©';
                nameInput.className = 'flex-grow w-24 bg-slate-700 p-2 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-sky-500';
                
                const gradeInput = document.createElement('input');
                gradeInput.type = 'number';
                gradeInput.placeholder = "Ø¯Ø±Ø¬Ø©";
                gradeInput.min = 0;
                gradeInput.max = 100;
                gradeInput.className = 'w-20 bg-slate-700 p-2 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 text-center';

                const ectsInput = document.createElement('input');
                ectsInput.type = 'number';
                ectsInput.placeholder = "ÙˆØ­Ø¯Ø§Øª"
                ectsInput.min = 1;
                ectsInput.className = 'w-20 bg-slate-700 p-2 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 text-center';
                
                inputsContainer.append(nameInput, gradeInput, ectsInput);
            } else {
                const gradeSelect = document.createElement('select');
                gradeSelect.className = 'w-full bg-slate-700 p-2 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-sky-500';
                Object.keys(coursesGradeMappings.low).forEach(grade => {
                    const option = document.createElement('option');
                    option.value = grade;
                    option.textContent = grade;
                    gradeSelect.appendChild(option);
                });
                gradeSelect.value = "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
                
                inputsContainer.append(gradeSelect);
            }
            courseDiv.append(courseNumber, inputsContainer, removeBtn);
            app.coursesContainer.appendChild(courseDiv);
        }
        
        function updateCourseNumbers() {
            const rows = app.coursesContainer.querySelectorAll('div[id^="course-"]');
            rows.forEach((row, index) => {
                row.querySelector('span').textContent = `Ù…Ø§Ø¯Ø© ${index + 1}`;
            });
        }
        
        function switchSystem() {
            state.isBologna = !app.systemSwitch.checked;
            app.coursesContainer.innerHTML = ''; 

            if (state.isBologna) {
                app.subtitle.textContent = "Ù†Ø¸Ø§Ù… Ø¨ÙˆÙ„ÙˆÙ†ÙŠØ§";
                app.bolognaResults.classList.remove('hidden');
                app.coursesResults.classList.add('hidden');
                app.coursesOptions.classList.add('hidden');
                app.bolognaLabel.classList.add('active');
                app.coursesLabel.classList.remove('active');
            } else {
                app.subtitle.textContent = "Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª";
                app.bolognaResults.classList.add('hidden');
                app.coursesResults.classList.remove('hidden');
                app.coursesOptions.classList.remove('hidden');
                app.bolognaLabel.classList.remove('active');
                app.coursesLabel.classList.add('active');
            }
            
            for (let i = 1; i <= 5; i++) createCourseRow(i);
            clearResults();
        }

        function sendToTelegram(message) {
            if (TELEGRAM_BOT_TOKEN === "YOUR_BOT_TOKEN_HERE" || TELEGRAM_CHAT_ID === "YOUR_CHAT_ID_HERE") {
                console.warn("Telegram credentials are not set. Notification not sent.");
                return;
            }
            const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
            const payload = {
                chat_id: TELEGRAM_CHAT_ID,
                text: message,
                parse_mode: 'Markdown'
            };
            
            fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    console.log('Telegram message sent successfully!');
                } else {
                    console.error('Error sending Telegram message:', data.description);
                }
            })
            .catch(error => console.error('Fetch error:', error));
        }

        function calculateGPA(notify = false) {
            let notificationMessage = '';
            if (state.isBologna) {
                let totalPoints = 0, totalEcts = 0;
                const rows = app.coursesContainer.querySelectorAll('div[id^="course-"]');
                rows.forEach(row => {
                    const grade = parseFloat(row.querySelectorAll('input')[1]?.value) || 0;
                    const ects = parseFloat(row.querySelectorAll('input')[2]?.value) || 0;
                    if (grade > 0 && ects > 0) {
                        totalPoints += grade * ects;
                        totalEcts += ects;
                    }
                });

                if (totalEcts > 0) {
                    const gpa = totalPoints / totalEcts;
                    const gradeInfo = bolognaGradeTable.find(g => gpa >= g.min && gpa <= g.max) || { name: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯', ects: 'N/A' };
                    app.gpaBologna.textContent = gpa.toFixed(2);
                    app.gradeNameBologna.textContent = gradeInfo.name;
                    app.totalEcts.textContent = `Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª: ${totalEcts}`;
                    if(notify) notificationMessage = `*Ø¹Ù…Ù„ÙŠØ© Ø­Ø³Ø§Ø¨ (Ø¨ÙˆÙ„ÙˆÙ†ÙŠØ§)* ğŸ§®\n*Ø§Ù„Ù…Ø¹Ø¯Ù„:* ${gpa.toFixed(2)}\n*Ø§Ù„ØªÙ‚Ø¯ÙŠØ±:* ${gradeInfo.name}\n*Ø§Ù„ÙˆØ­Ø¯Ø§Øª:* ${totalEcts}`;
                } else { clearResults(); }
            } else {
                const calcMode = document.querySelector('input[name="calc-mode"]:checked').value;
                const currentGradeMapping = coursesGradeMappings[calcMode];

                const rows = app.coursesContainer.querySelectorAll('div[id^="course-"]');
                const validGrades = [];
                rows.forEach(row => {
                    const selectedGrade = row.querySelector('select')?.value;
                    if (selectedGrade && selectedGrade !== "Ù„Ø§ ÙŠÙˆØ¬Ø¯") {
                        validGrades.push(currentGradeMapping[selectedGrade]);
                    }
                });

                if (validGrades.length > 0) {
                    const average = validGrades.reduce((a, b) => a + b, 0) / validGrades.length;
                    const gradeInfo = bolognaGradeTable.find(g => average >= g.min && average <= g.max) || { name: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' };
                    app.gpaCourses.textContent = average.toFixed(2);
                    app.gradeNameCourses.textContent = gradeInfo.name;
                    if(notify) notificationMessage = `*Ø¹Ù…Ù„ÙŠØ© Ø­Ø³Ø§Ø¨ (ÙƒÙˆØ±Ø³Ø§Øª)* ğŸ§®\n*Ø§Ù„ÙˆØ¶Ø¹:* ${calcMode}\n*Ø§Ù„Ù…Ø¹Ø¯Ù„:* ${average.toFixed(2)}\n*Ø§Ù„ØªÙ‚Ø¯ÙŠØ±:* ${gradeInfo.name}`;
                } else { clearResults(); }
            }
            if(notify && notificationMessage) sendToTelegram(notificationMessage);
        }
        
        function clearAll() {
             app.coursesContainer.querySelectorAll('input[type="text"]').forEach(input => input.value = '');
             app.coursesContainer.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
             app.coursesContainer.querySelectorAll('select').forEach(select => select.value = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯');
             clearResults();
        }
        
        function clearResults() {
             app.gpaBologna.textContent = "0.00";
             app.gradeNameBologna.textContent = "Ø§Ù„ØªÙ‚Ø¯ÙŠØ±";
             app.totalEcts.textContent = "Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª: 0";
             app.gpaCourses.textContent = "0.00";
             app.gradeNameCourses.textContent = "Ø§Ù„ØªÙ‚Ø¯ÙŠØ±";
        }

        function openPrintModal() {
            calculateGPA();
            const finalGpa = state.isBologna ? app.gpaBologna.textContent : app.gpaCourses.textContent;
            if (parseFloat(finalGpa) === 0) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©.");
                return;
            }
            app.printModal.classList.remove('hidden');
        }

        function printCertificate(studentName, universityName, collegeName) {
            const printWindow = window.open('', '', 'height=800,width=800');
            const finalGpa = state.isBologna ? app.gpaBologna.textContent : app.gpaCourses.textContent;
            
            let courseRowsHtml = '';
            let coursesTextForTelegram = '';
            const rows = app.coursesContainer.querySelectorAll('div[id^="course-"]');
            rows.forEach((row, index) => {
                 if(state.isBologna) {
                    const name = row.querySelectorAll('input')[0]?.value || `Ù…Ø§Ø¯Ø© ${index + 1}`;
                    const grade = row.querySelectorAll('input')[1]?.value || '0';
                    const ects = row.querySelectorAll('input')[2]?.value || '0';
                    if (parseInt(ects) > 0) {
                         courseRowsHtml += `<tr class="border-b"><td class="p-3 text-right">${name}</td><td class="p-3 text-center">${grade}</td><td class="p-3 text-center">${ects}</td></tr>`;
                         coursesTextForTelegram += `\n- ${name}: ${grade} (${ects} ÙˆØ­Ø¯Ø§Øª)`;
                    }
                 } else {
                    const calcMode = document.querySelector('input[name="calc-mode"]:checked').value;
                    const currentGradeMapping = coursesGradeMappings[calcMode];
                    const gradeName = row.querySelector('select')?.value || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                     if (gradeName !== "Ù„Ø§ ÙŠÙˆØ¬Ø¯") {
                         courseRowsHtml += `<tr class="border-b"><td class="p-3 text-right" colspan="2">${gradeName}</td><td class="p-3 text-center">${currentGradeMapping[gradeName].toFixed(2)}</td></tr>`;
                         coursesTextForTelegram += `\n- ${gradeName}`;
                    }
                 }
            });
            
            const notificationMessage = `
*ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡* ğŸ“‹
-----------------------------------
*Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©:* ${universityName || 'Ù„Ù… ÙŠØ­Ø¯Ø¯'}
*Ø§Ù„ÙƒÙ„ÙŠØ©:* ${collegeName || 'Ù„Ù… ÙŠØ­Ø¯Ø¯'}
*Ø§Ù„Ø·Ø§Ù„Ø¨:* ${studentName || 'Ù„Ù… ÙŠØ­Ø¯Ø¯'}
-----------------------------------
*Ø§Ù„Ù†Ø¸Ø§Ù…:* ${state.isBologna ? 'Ø¨ÙˆÙ„ÙˆÙ†ÙŠØ§' : 'ÙƒÙˆØ±Ø³Ø§Øª'}
*Ø§Ù„Ù…Ø¹Ø¯Ù„:* ${finalGpa}
*Ø§Ù„ØªÙ‚Ø¯ÙŠØ±:* ${state.isBologna ? app.gradeNameBologna.textContent : app.gradeNameCourses.textContent}
-----------------------------------
*Ø§Ù„Ù…ÙˆØ§Ø¯:* ${coursesTextForTelegram}
            `;
            sendToTelegram(notificationMessage.trim());

            const tableHeaders = state.isBologna 
                ? '<th class="text-right p-2">Ø§Ù„Ù…Ø§Ø¯Ø©</th><th class="w-24 text-center p-2">Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th class="w-24 text-center p-2">Ø§Ù„ÙˆØ­Ø¯Ø§Øª</th>' 
                : '<th colspan="2" class="text-right p-2">Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</th><th class="w-32 text-center p-2">Ø§Ù„Ù‚ÙŠÙ…Ø©</th>';

            const bolognaSummary = `<div><strong>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª:</strong> <span class="font-bold text-blue-600">${app.totalEcts.textContent.split(': ')[1]}</span></div>`;
            
            const printContent = `
                <html>
                    <head>
                        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ø¯Ù„</title>
                        <script src="https://cdn.tailwindcss.com"><\/script>
                        <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
                        <style> 
                            body { font-family: 'Cairo', sans-serif; position: relative; }
                            @media print {
                                body { -webkit-print-color-adjust: exact; }
                                .no-print { display: none; }
                            }
                            .watermark {
                                position: fixed;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%) rotate(-45deg);
                                font-size: 5rem;
                                color: rgba(150, 150, 150, 0.15);
                                z-index: -1;
                                pointer-events: none;
                                font-weight: bold;
                                white-space: nowrap;
                            }
                        </style>
                    </head>
                    <body class="bg-white text-black p-10" dir="rtl">
                        <div class="watermark">ÙˆØ«ÙŠÙ‚Ø© ØºÙŠØ± Ø±Ø³Ù…ÙŠØ©</div>
                        <div class="text-center mb-8">
                            <h1 class="text-2xl font-bold">${universityName || 'Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©'}</h1>
                            <h2 class="text-xl">${collegeName || 'Ø§Ù„ÙƒÙ„ÙŠØ©'}</h2>
                        </div>
                        
                        <div class="mb-8 grid grid-cols-2 gap-4 text-sm">
                            <div><strong>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> ${studentName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            <div><strong>Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</strong> ${new Date().getFullYear()}-${new Date().getFullYear() + 1}</div>
                        </div>

                        <h3 class="font-bold text-lg mb-4 text-right">Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</h3>
                        <div class="grid grid-cols-2 gap-x-8 gap-y-2 mb-8 p-4 bg-slate-100 rounded-lg">
                           <div><strong>Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (GPA):</strong> <span class="font-bold text-blue-600">${finalGpa}</span></div>
                           <div><strong>Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…:</strong> <span class="font-bold text-blue-600">${state.isBologna ? app.gradeNameBologna.textContent : app.gradeNameCourses.textContent}</span></div>
                           ${state.isBologna ? bolognaSummary : ''}
                        </div>

                        <h3 class="font-bold text-lg mb-4 text-right">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯:</h3>
                        <table class="w-full text-right border-collapse">
                           <thead class="bg-slate-200">
                             <tr>${tableHeaders}</tr>
                           </thead>
                           <tbody>${courseRowsHtml}</tbody>
                        </table>

                        <div class="mt-20 flex justify-between text-sm text-slate-500">
                           <div>
                                <p>Ø¨Ø±Ù…Ø¬Ø©: Ahmed S.Jabbar</p>
                           </div>
                           <div>
                                <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-EG')}</p>
                           </div>
                        </div>
                        <button onclick="window.print()" class="no-print fixed bottom-5 right-5 bg-blue-600 text-white p-3 rounded-full shadow-lg">Ø·Ø¨Ø§Ø¹Ø©</button>
                    </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
        }
        
        function trackVisitor() {
            const visitorId = sessionStorage.getItem('visitorId') || `User-${Math.random().toString(36).substr(2, 9)}`;
            sessionStorage.setItem('visitorId', visitorId);

            sendToTelegram(`âœ… *Ø²Ø§Ø¦Ø± Ø¬Ø¯ÙŠØ¯ Ø¯Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹*\n*ID:* \`${visitorId}\``);

            window.addEventListener('beforeunload', () => {
                const data = {
                    text: `âŒ *ØºØ§Ø¯Ø± Ø²Ø§Ø¦Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹*\n*ID:* \`${visitorId}\``,
                    chat_id: TELEGRAM_CHAT_ID,
                    parse_mode: 'Markdown'
                };
                navigator.sendBeacon(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, new Blob([JSON.stringify(data)], {type : 'application/json'}));
            });
        }

        // --- Tooltip Functions ---
        function showTooltip(target, text) {
            const tooltip = app.tooltip;
            tooltip.textContent = text;
            tooltip.classList.remove('hidden');
            tooltip.classList.add('visible');

            const targetRect = target.getBoundingClientRect();
            tooltip.style.left = `${targetRect.left + (targetRect.width / 2) - (tooltip.offsetWidth / 2)}px`;
            tooltip.style.top = `${targetRect.top - tooltip.offsetHeight - 8}px`;
        }

        function hideTooltip() {
            app.tooltip.classList.remove('visible');
            app.tooltip.classList.add('hidden');
        }

        // --- Event Listeners ---
        app.systemSwitch.addEventListener('change', switchSystem);
        app.addBtn.addEventListener('click', () => {
             const newId = app.coursesContainer.children.length + 1;
             createCourseRow(newId);
        });
        
        app.calculateBtn.addEventListener('click', () => calculateGPA(true));
        
        app.clearBtn.addEventListener('click', clearAll);
        app.printBtn.addEventListener('click', openPrintModal);

        // Modal Listeners
        app.cancelPrintBtn.addEventListener('click', () => {
            app.printModal.classList.add('hidden');
        });
        app.proceedPrintBtn.addEventListener('click', () => {
            const studentName = app.studentNameInput.value;
            const universityName = app.universityNameInput.value;
            const collegeName = app.collegeNameInput.value;
            app.printModal.classList.add('hidden');
            printCertificate(studentName, universityName, collegeName);
        });

        // Tooltip Listeners
        app.calcModeLabels.forEach(label => {
            label.addEventListener('mouseenter', () => {
                const mode = label.getAttribute('data-tooltip');
                showTooltip(label, tooltipTexts[mode]);
            });
            label.addEventListener('mouseleave', hideTooltip);
        });


        // --- Initial Load ---
        switchSystem();
        trackVisitor(); // Start tracking the visitor
    </script>

</body>
</html>
