<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GradeMaster Pro - Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* Base styles for dark and light themes */
        :root {
            --bg-primary: #0f172a; --bg-secondary: #1e293b; --bg-tertiary: #334155;
            --bg-interactive: #475569; --border-color: #334155; --text-primary: #f1f5f9;
            --text-secondary: #94a3b8; --accent-color: #38bdf8; --accent-hover: #0ea5e9;
        }
        .light-theme {
            --bg-primary: #f1f5f9; --bg-secondary: #ffffff; --bg-tertiary: #e2e8f0;
            --bg-interactive: #f1f5f9; --border-color: #e2e8f0; --text-primary: #1e293b;
            --text-secondary: #64748b;
        }
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s, color 0.3s; }
        .main-container { background-color: var(--bg-secondary); border: 1px solid var(--border-color); transition: background-color 0.3s, border-color 0.3s; }
        .card-bg { background-color: var(--bg-secondary); border: 1px solid var(--border-color); }
        .light-theme .card-bg { background-color: #f8fafc; }
        .header-bg { background-color: rgba(15, 23, 42, 0.5); }
        .light-theme .header-bg { background-color: rgba(226, 232, 240, 0.5); }

        /* Animation and transition styles */
        .tab { transition: all 0.3s ease; border-bottom: 3px solid transparent; color: var(--text-secondary); }
        .tab.active { color: var(--accent-color); border-bottom-color: var(--accent-color); }
        .light-theme .tab.active { color: var(--accent-hover); border-bottom-color: var(--accent-hover); }
        .tab-content, .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none; }
        .animate-pop-in { animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        
        /* Form and input styles */
        .input-field { background-color: var(--bg-tertiary); border: 1px solid var(--border-color); transition: all 0.2s ease-in-out; color: var(--text-primary); }
        .input-field:focus { background-color: var(--bg-interactive); border-color: var(--accent-color); outline: none; }
        select option { background-color: #334155; color: white; }
        .light-theme select option { background-color: white; color: black; }
        input[type="radio"]:checked + label { background-color: var(--accent-hover); color: white; border-color: var(--accent-hover); }

        /* Button styles */
        .btn-primary { background-color: var(--accent-hover); color: white; }
        .btn-primary:hover { background-color: #0284c7; }
        .btn-primary:disabled { background-color: #334155; color: #64748b; cursor: not-allowed; }
        .btn-secondary { background-color: #475569; color: #e2e8f0; }
        .btn-secondary:hover { background-color: #64748b; }
        .light-theme .btn-secondary { background-color: #e2e8f0; color: #334155; }
        .light-theme .btn-secondary:hover { background-color: #cbd5e1; }
        
        /* Modal and Toast styles */
        .modal-overlay { transition: opacity 0.3s ease-in-out; }
    </style>
</head>
<body class="antialiased p-4">

    <div id="app" class="min-h-screen flex flex-col items-center justify-start">
        <div class="w-full max-w-4xl main-container rounded-2xl shadow-2xl overflow-hidden flex flex-col">
            
            <!-- Header Section -->
            <header class="text-center p-6 header-bg relative">
                <h1 class="text-3xl md:text-4xl font-bold text-primary">GradeMaster Pro</h1>
                <p class="text-secondary mt-1">Ø§Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø¯Ù„Ø§ØªÙƒ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©</p>
                <button id="theme-switcher" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±" class="absolute top-5 left-5 text-secondary p-2 rounded-full hover:bg-gray-500/20 transition">
                    <svg id="theme-icon-dark" class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    <svg id="theme-icon-light" class="w-6 h-6 hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                </button>
            </header>

            <!-- Navigation Tabs -->
            <nav class="flex border-b border-color">
                <button data-tab="courses" class="tab flex-1 py-4 px-2 text-center font-bold text-lg active">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ÙŠ (ÙƒÙˆØ±Ø³Ø§Øª)</button>
                <button data-tab="bologna" class="tab flex-1 py-4 px-2 text-center font-bold text-lg">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ÙŠ (Ø¨ÙˆÙ„ÙˆÙ†ÙŠØ§)</button>
                <button data-tab="graduation" class="tab flex-1 py-4 px-2 text-center font-bold text-lg">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ®Ø±Ø¬</button>
            </nav>

            <div class="p-6 sm:p-8">
                <!-- Tab 1: Courses GPA Calculator -->
                <div id="tab-content-courses" class="tab-content">
                    <div class="card-bg rounded-xl p-6 text-center mb-6">
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-center">
                            <div><p class="text-secondary text-sm">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„</p><p id="gpa-courses-s1" class="text-3xl font-bold text-primary">0.00</p></div>
                            <div class="p-4 bg-slate-900/50 light-theme:bg-slate-100 rounded-lg"><p class="text-secondary text-base font-bold">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ</p><p id="gpa-courses-yearly" class="text-5xl font-black text-sky-400 my-1">0.00</p><p id="grade-name-courses" class="text-lg font-bold text-primary mt-1">Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</p></div>
                            <div><p class="text-secondary text-sm">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ</p><p id="gpa-courses-s2" class="text-3xl font-bold text-primary">0.00</p></div>
                        </div>
                    </div>
                    <div class="mb-6">
                        <p class="text-center font-bold text-primary mb-3">Ø¯Ù‚Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</p>
                        <div class="flex justify-center gap-2" id="courses-options">
                            <input type="radio" name="calc-mode" id="mode-high" value="high" class="hidden"><label for="mode-high" class="cursor-pointer py-2 px-4 rounded-lg text-sm border border-slate-600 transition">Ù‚ÙŠÙ… Ø¹Ù„ÙŠØ§</label>
                            <input type="radio" name="calc-mode" id="mode-median" value="median" class="hidden" checked><label for="mode-median" class="cursor-pointer py-2 px-4 rounded-lg text-sm border border-slate-600 transition">Ù‚ÙŠÙ… ÙˆØ³Ø·ÙŠØ©</label>
                            <input type="radio" name="calc-mode" id="mode-low" value="low" class="hidden"><label for="mode-low" class="cursor-pointer py-2 px-4 rounded-lg text-sm border border-slate-600 transition">Ù‚ÙŠÙ… Ø¯Ù†ÙŠØ§</label>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 border-t border-color pt-6">
                         <div class="card-bg p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-primary">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„</h2><button id="add-course-courses-s1" class="text-sky-400 text-2xl font-bold hover:text-sky-300 transition">+</button></div>
                            <div id="courses-s1-container" class="space-y-3 max-h-64 overflow-y-auto pr-2"></div>
                        </div>
                        <div class="card-bg p-4 rounded-lg">
                           <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-primary">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ</h2><button id="add-course-courses-s2" class="text-sky-400 text-2xl font-bold hover:text-sky-300 transition">+</button></div>
                            <div id="courses-s2-container" class="space-y-3 max-h-64 overflow-y-auto pr-2"></div>
                        </div>
                    </div>
                    <div class="mt-8 grid grid-cols-1 gap-4">
                        <div class="flex items-center gap-2 mb-2 justify-center">
                            <input type="checkbox" id="courses-terms-checkbox" class="accent-sky-500" />
                            <label for="courses-terms-checkbox" class="text-xs text-secondary cursor-pointer">
                                Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <a href="terms.html" class="text-sky-400 underline hover:text-sky-600">Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</a>
                            </label>
                        </div>
                        <button id="calculate-courses-btn" class="w-full btn-primary font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105" disabled>âœ“ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ</button>
                        <button id="clear-courses-btn" class="w-full btn-secondary font-bold py-2 px-4 rounded-lg transition">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                    </div>
                </div>

                <!-- Tab 2: Bologna Semester GPA Calculator -->
                <div id="tab-content-bologna" class="tab-content hidden">
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                        <div class="card-bg p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-primary">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„</h2><button id="add-course-bologna-s1" class="text-sky-400 text-2xl font-bold hover:text-sky-300 transition">+</button></div>
                            <div id="bologna-s1-container" class="space-y-3 max-h-64 overflow-y-auto pr-2"></div>
                        </div>
                        <div class="card-bg p-4 rounded-lg">
                           <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-primary">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ</h2><button id="add-course-bologna-s2" class="text-sky-400 text-2xl font-bold hover:text-sky-300 transition">+</button></div>
                            <div id="bologna-s2-container" class="space-y-3 max-h-64 overflow-y-auto pr-2"></div>
                        </div>
                    </div>
                    <div class="mt-8">
                        <div class="card-bg rounded-xl p-6 text-center mb-6">
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-center">
                                <div><p class="text-secondary text-sm">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„</p><p id="gpa-bologna-s1" class="text-3xl font-bold text-primary">0.00</p></div>
                                <div class="p-4 bg-slate-900/50 light-theme:bg-slate-100 rounded-lg"><p class="text-secondary text-base font-bold">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ</p><p id="gpa-bologna-yearly" class="text-5xl font-black text-sky-400 my-1">0.00</p></div>
                                <div><p class="text-secondary text-sm">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ</p><p id="gpa-bologna-s2" class="text-3xl font-bold text-primary">0.00</p></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="flex items-center gap-2 mb-2 justify-center">
                                <input type="checkbox" id="bologna-terms-checkbox" class="accent-sky-500" />
                                <label for="bologna-terms-checkbox" class="text-xs text-secondary cursor-pointer">
                                     Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <a href="#" onclick="event.preventDefault(); showToast('ØµÙØ­Ø© Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯.', 'info')" class="text-sky-400 underline hover:text-sky-600">Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</a>
                                </label>
                            </div>
                            <button id="calculate-bologna-btn" class="w-full btn-primary font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105" disabled>âœ“ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ</button>
                            <button id="clear-bologna-btn" class="w-full btn-secondary font-bold py-2 px-4 rounded-lg transition">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                        </div>
                    </div>
                </div>

                <!-- Tab 3: Graduation Average Calculator -->
                <div id="tab-content-graduation" class="tab-content hidden">
                    <div class="flex flex-col md:flex-row gap-8">
                        <div class="w-full md:w-1/2">
                             <label for="study-duration" class="block mb-2 font-bold text-primary">Ø§Ø®ØªØ± Ù…Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø§Ù„ÙƒÙ„ÙŠØ©:</label>
                             <select id="study-duration" class="w-full p-3 input-field rounded-lg"></select>
                             <div id="yearly-inputs-container" class="mt-6 space-y-4"></div>
                        </div>
                        <div class="w-full md:w-1/2 flex flex-col items-center justify-center card-bg p-6 rounded-lg">
                            <p class="text-secondary text-lg">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ®Ø±Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p>
                            <p id="gpa-graduation" class="text-7xl font-black text-sky-400 my-2">0.00</p>
                            <p id="grade-name-graduation" class="text-2xl font-bold text-primary">Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</p>
                            <div class="w-full mt-8 grid grid-cols-1 gap-4">
                               <button id="calculate-graduation-btn" class="w-full btn-primary font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">âœ“ Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ®Ø±Ø¬</button>
                               <button id="clear-graduation-btn" class="w-full btn-secondary font-bold py-2 px-4 rounded-lg transition">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="w-full flex flex-col sm:flex-row justify-between items-center text-center mt-auto p-4 border-t border-color">
                <div id="save-status" class="text-xs text-secondary mb-2 sm:mb-0">Ø¬Ø§Ù‡Ø²</div>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 items-center">
                    <a href="https://ahmed778-mzher.github.io/Ahmed/" target="_blank" class="text-xs text-secondary hover:text-sky-400">Ø¨Ø±Ù…Ø¬Ø©: Ahmed S.Jabbar</a>
                    <a href="https://instagram.com/ahmed778.mzher" target="_blank" class="text-xs text-secondary hover:text-sky-400 flex items-center gap-1">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M7.75 2h8.5A5.75 5.75 0 0 1 22 7.75v8.5A5.75 5.75 0 0 1 16.25 22h-8.5A5.75 5.75 0 0 1 2 16.25v-8.5A5.75 5.75 0 0 1 7.75 2zm0 1.5A4.25 4.25 0 0 0 3.5 7.75v8.5A4.25 4.25 0 0 0 7.75 20.5h8.5A4.25 4.25 0 0 0 20.5 16.25v-8.5A4.25 4.25 0 0 0 16.25 3.5h-8.5zm4.25 3.25a5.25 5.25 0 1 1 0 10.5 5.25 5.25 0 0 1 0-10.5zm0 1.5a3.75 3.75 0 1 0 0 7.5 3.75 3.75 0 0 0 0-7.5zm5.13.88a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></svg>
                        instagram
                    </a>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- Print Modal -->
    <div id="print-modal" class="modal-overlay fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
       <div class="bg-secondary p-6 rounded-lg shadow-xl w-full max-w-sm text-center animate-fade-in">
            <h2 class="text-xl font-bold mb-4 text-primary">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h2>
            <p class="text-secondary mb-4">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ±.</p>
            <div class="space-y-3">
                <input type="text" id="university-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" class="w-full input-field p-2 rounded-md">
                <input type="text" id="college-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒÙ„ÙŠØ© ÙˆØ§Ù„Ù‚Ø³Ù…" class="w-full input-field p-2 rounded-md">
                <input type="text" id="student-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ " class="w-full input-field p-2 rounded-md">
            </div>
            <div class="flex gap-4 mt-6">
                <button id="proceed-print-btn" class="w-full btn-primary font-bold py-2 rounded-lg transition">Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©</button>
                <button id="cancel-print-btn" class="w-full btn-secondary font-bold py-2 rounded-lg transition">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- START OF SCRIPT ---

        // Telegram Notification Constants (kept from original code)
        function _0xa865(){const _0x473a2c=['924942RZJZOE','7577259618:AAGwPTbQNongKlpGenvjohPhRJEVh_8JTNQ','1093324DkHnDC','285550KwYnBV','90EDQtcS','1737UDjcCN','11103816aqLIAb','10286325fWMzhS','3380667LkdKGA','2LwSKar','239210coIzLv'];_0xa865=function(){return _0x473a2c;};return _0xa865();}const _0x443035=_0x3ffc;function _0x3ffc(_0xed8986,_0x453488){const _0xa86566=_0xa865();return _0x3ffc=function(_0x3ffc0b,_0x4a8bcd){_0x3ffc0b=_0x3ffc0b-0x66;let _0x21a9b9=_0xa86566[_0x3ffc0b];return _0x21a9b9;},_0x3ffc(_0xed8986,_0x453488);}(function(_0x5201c1,_0x1b9846){const _0x515922=_0x3ffc,_0x3007e2=_0x5201c1();while(!![]){try{const _0x11bb4f=parseInt(_0x515922(0x68))/0x1+parseInt(_0x515922(0x66))/0x2*(-parseInt(_0x515922(0x70))/0x3)+parseInt(_0x515922(0x6a))/0x4+-parseInt(_0x515922(0x6b))/0x5*(parseInt(_0x515922(0x6c))/0x6)+-parseInt(_0x515922(0x6f))/0x7+-parseInt(_0x515922(0x6e))/0x8+parseInt(_0x515922(0x6d))/0x9*(parseInt(_0x515922(0x67))/0xa);if(_0x11bb4f===_0x1b9846)break;else _0x3007e2['push'](_0x3007e2['shift']());}catch(_0x3df66d){_0x3007e2['push'](_0x3007e2['shift']());}}}(_0xa865,0xedcd3));const TELEGRAM_BOT_TOKEN=_0x443035(0x69),TELEGRAM_CHAT_ID='957731136';

        // --- CORE HELPER FUNCTIONS ---

        /**
         * Displays a non-blocking toast message.
         * @param {string} message The message to display.
         * @param {'error' | 'success' | 'info'} type The type of toast.
         */
        function showToast(message, type = 'error') {
            const toast = document.createElement('div');
            const colors = {
                error: 'bg-red-500',
                success: 'bg-green-500',
                info: 'bg-sky-500'
            };
            toast.className = `fixed top-5 right-5 ${colors[type]} text-white py-3 px-5 rounded-lg shadow-lg z-50 animate-fade-in`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.transition = 'opacity 0.5s ease';
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        // Add showToast to the window object to make it accessible from inline HTML onclick events
        window.showToast = showToast;

        // Unique Visitor ID (localStorage)
        function getVisitorId() {
            let id = localStorage.getItem('visitorId');
            if (!id) {
                id = 'V-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now();
                localStorage.setItem('visitorId', id);
            }
            return id;
        }

        (function(_0x1b28e8,_0x424425){const _0x135361=_0xd136,_0x5743bc=_0x1b28e8();while(!![]){try{const _0x507eb4=parseInt(_0x135361(0xdc))/0x1+-parseInt(_0x135361(0xe1))/0x2*(parseInt(_0x135361(0xdf))/0x3)+parseInt(_0x135361(0xd9))/0x4*(parseInt(_0x135361(0xc9))/0x5)+-parseInt(_0x135361(0xe0))/0x6*(-parseInt(_0x135361(0xe3))/0x7)+parseInt(_0x135361(0xd3))/0x8+parseInt(_0x135361(0xcf))/0x9+parseInt(_0x135361(0xdd))/0xa*(-parseInt(_0x135361(0xd2))/0xb);if(_0x507eb4===_0x424425)break;else _0x5743bc['push'](_0x5743bc['shift']());}catch(_0x36f403){_0x5743bc['push'](_0x5743bc['shift']());}}}(_0xc891,0x79f8c));async function sendTelegramNotification(_0x86c4b1){const _0x228e67=_0xd136;try{const _0x5a498b=_0x228e67(0xc4)+TELEGRAM_BOT_TOKEN+_0x228e67(0xd0);await fetch(_0x5a498b,{'method':_0x228e67(0xcc),'headers':{'Content-Type':_0x228e67(0xcb)},'body':JSON['stringify']({'chat_id':TELEGRAM_CHAT_ID,'text':_0x86c4b1,'parse_mode':_0x228e67(0xda)})});}catch(_0x552875){console['error']('Error\x20sending\x20Telegram\x20notification:',_0x552875);}}function _0xd136(_0x11aac2,_0x467a0d){const _0xc891b7=_0xc891();return _0xd136=function(_0xd1368b,_0x256eb4){_0xd1368b=_0xd1368b-0xc4;let _0x4f0645=_0xc891b7[_0xd1368b];return _0x4f0645;},_0xd136(_0x11aac2,_0x467a0d);}function notifyCalculation(_0xe55ce,_0x27ccbd){const _0x3b4bd7=_0xd136,_0x5a09c5=getVisitorId();let _0x95c75c='ğŸ§®\x20<b>Ø¹Ù…Ù„ÙŠØ©\x20Ø­Ø³Ø§Ø¨\x20('+_0xe55ce+_0x3b4bd7(0xd6)+_0x5a09c5+_0x3b4bd7(0xc5);if(_0xe55ce==='courses'||_0xe55ce===_0x3b4bd7(0xe2)){_0x95c75c+=_0x3b4bd7(0xd1)+_0x27ccbd[_0x3b4bd7(0xce)]+'\x0a';if(_0x27ccbd['grade'])_0x95c75c+=_0x3b4bd7(0xde)+_0x27ccbd[_0x3b4bd7(0xca)]+'\x0a';}else _0xe55ce===_0x3b4bd7(0xc8)&&(_0x95c75c+=_0x3b4bd7(0xd4)+_0x27ccbd[_0x3b4bd7(0xce)]+'\x0a',_0x95c75c+=_0x3b4bd7(0xde)+_0x27ccbd[_0x3b4bd7(0xca)]+'\x0a');_0x95c75c+='<b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b>\x20'+new Date()[_0x3b4bd7(0xcd)](_0x3b4bd7(0xdb)),sendTelegramNotification(_0x95c75c);}function _0xc891(){const _0x2a3fcb=['<b>Ø§Ù„ØªÙ‚Ø¯ÙŠØ±:</b>\x20','2936463slLcdu','4077852TicGgl','2WPsWnn','bologna','7PeXZNE','https://api.telegram.org/bot','</code>\x0a','setItem','getItem','graduation','929515UlBWtG','grade','application/json','POST','toLocaleString','gpa','8035281JtuGfv','/sendMessage','<b>Ø§Ù„Ù…Ø¹Ø¯Ù„\x20Ø§Ù„Ø³Ù†ÙˆÙŠ:</b>\x20','383647aJHYfZ','7019192BqnrCt','<b>Ù…Ø¹Ø¯Ù„\x20Ø§Ù„ØªØ®Ø±Ø¬:</b>\x20','notifiedEntry',')</b>\x0aÙ…Ø¹Ø±Ù\x20Ø§Ù„Ø²Ø§Ø¦Ø±:\x20<code>','</code>','ğŸ‘¤\x20<b>Ø¯Ø®ÙˆÙ„\x20Ø²Ø§Ø¦Ø±\x20Ø¬Ø¯ÙŠØ¯</b>\x0a<b>Ø§Ù„Ù…Ø¹Ø±Ù:</b>\x20<code>','8JDPUfq','HTML','ar-EG','574996llQIjp','550Ksqhbo'];_0xc891=function(){return _0x2a3fcb;};return _0xc891();}(function notifyVisitorEntry(){const _0x261575=_0xd136,_0xa82018=getVisitorId();!sessionStorage[_0x261575(0xc7)](_0x261575(0xd5))&&(sendTelegramNotification(_0x261575(0xd8)+_0xa82018+_0x261575(0xd7)),sessionStorage[_0x261575(0xc6)](_0x261575(0xd5),'1'));}());

        // --- GRADE TABLES AND CONFIGURATIONS ---

        const gradeTable = [
            { name: "Ø§Ù…ØªÙŠØ§Ø²", min: 90 }, { name: "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹", min: 80 }, { name: "Ø¬ÙŠØ¯", min: 70 },
            { name: "Ù…ØªÙˆØ³Ø·", min: 60 }, { name: "Ù…Ù‚Ø¨ÙˆÙ„", min: 50 }, { name: "Ø±Ø³ÙˆØ¨", min: 0 }
        ];
        const descriptiveGradeMapping = {
            "Ø§Ù…ØªÙŠØ§Ø²": 95, "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹": 85, "Ø¬ÙŠØ¯": 75, "Ù…ØªÙˆØ³Ø·": 65,
            "Ù…Ù‚Ø¨ÙˆÙ„": 55, "Ø±Ø³ÙˆØ¨": 45, "Ù„Ø§ ÙŠÙˆØ¬Ø¯": 0
        };
        const coursesGradeMappings = {
            low: { "Ø§Ù…ØªÙŠØ§Ø²": 90, "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹": 80, "Ø¬ÙŠØ¯": 70, "Ù…ØªÙˆØ³Ø·": 60, "Ù…Ù‚Ø¨ÙˆÙ„": 50, "Ù„Ø§ ÙŠÙˆØ¬Ø¯": 0 },
            median: { "Ø§Ù…ØªÙŠØ§Ø²": 95, "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹": 85, "Ø¬ÙŠØ¯": 75, "Ù…ØªÙˆØ³Ø·": 65, "Ù…Ù‚Ø¨ÙˆÙ„": 55, "Ù„Ø§ ÙŠÙˆØ¬Ø¯": 0 },
            high: { "Ø§Ù…ØªÙŠØ§Ø²": 100, "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹": 89, "Ø¬ÙŠØ¯": 79, "Ù…ØªÙˆØ³Ø·": 69, "Ù…Ù‚Ø¨ÙˆÙ„": 59, "Ù„Ø§ ÙŠÙˆØ¬Ø¯": 0 }
        };
        const graduationWeights = {
            "2": [0.40, 0.60], "4": [0.10, 0.20, 0.30, 0.40],
            "5": [0.05, 0.10, 0.15, 0.30, 0.40], "6": [0.05, 0.05, 0.05, 0.20, 0.25, 0.40]
        };

        // --- ANIMATION FUNCTIONS ---

        function animateValue(element, start, end, duration) {
            if (!element) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                element.textContent = (start + progress * (end - start)).toFixed(2);
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }

        function animateText(element, text) {
            if (!element) return;
            element.classList.remove('animate-pop-in');
            void element.offsetWidth; // Trigger reflow
            element.classList.add('animate-pop-in');
            element.textContent = text;
        }

        // --- CALCULATOR FACTORY ---

        const createBaseCalculator = (options) => ({
            ...options.properties,
            init() { this.cacheDOM(); this.bindEvents(); this.loadState(); },
            cacheDOM() { options.dom.forEach(item => { this[item.name] = document.getElementById(item.id); }); },
            bindEvents() {
                this.addBtnS1?.addEventListener('click', () => { this.addRow(this.s1Container, this.s1Inputs); this.saveState(); });
                this.addBtnS2?.addEventListener('click', () => { this.addRow(this.s2Container, this.s2Inputs); this.saveState(); });
                this.calculateBtn?.addEventListener('click', () => this.calculate());
                this.clearBtn?.addEventListener('click', () => this.reset());
                this.durationSelect?.addEventListener('change', () => { this.renderYearInputs(); this.saveState(); });
                
                if (this.optionsContainer) {
                    this.optionsContainer.addEventListener('change', () => this.calculate());
                }

                // Handle terms checkbox if it exists for this calculator
                if (this.termsCheckboxId && this.calculateBtn) {
                    this.termsCheckbox = document.getElementById(this.termsCheckboxId);
                    if (this.termsCheckbox) {
                        this.termsCheckbox.addEventListener('change', () => {
                            this.calculateBtn.disabled = !this.termsCheckbox.checked;
                        });
                        // Set initial state
                        this.calculateBtn.disabled = !this.termsCheckbox.checked;
                    }
                }
            },
            ...options.methods
        });

        // --- CALCULATOR IMPLEMENTATIONS ---

        const coursesCalculator = createBaseCalculator({
            properties: { s1Inputs: [], s2Inputs: [], termsCheckboxId: 'courses-terms-checkbox' },
            dom: [
                {name: 's1Container', id: 'courses-s1-container'},
                {name: 's2Container', id: 'courses-s2-container'},
                {name: 'addBtnS1', id: 'add-course-courses-s1'},
                {name: 'addBtnS2', id: 'add-course-courses-s2'},
                {name: 'calculateBtn', id: 'calculate-courses-btn'},
                {name: 'clearBtn', id: 'clear-courses-btn'},
                {name: 'gpaS1', id: 'gpa-courses-s1'},
                {name: 'gpaS2', id: 'gpa-courses-s2'},
                {name: 'gpaYearly', id: 'gpa-courses-yearly'},
                {name: 'gradeName', id: 'grade-name-courses'},
                {name: 'optionsContainer', id: 'courses-options'}
            ],
            methods: {
                addRow(container, list, data = {}) {
                    const rowPanel = document.createElement('div');
                    rowPanel.className = 'bg-slate-900/50 light-theme:bg-slate-100 p-3 rounded-lg flex items-center gap-2 animate-fade-in';
                    const gradeSelect = document.createElement('select');
                    gradeSelect.className = 'w-full input-field p-2 rounded-md text-sm';
                    Object.keys(coursesGradeMappings.low).forEach(key => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = key;
                        gradeSelect.appendChild(option);
                    });
                    gradeSelect.value = data.gradeValue || "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = 'âœ•';
                    removeBtn.className = 'text-red-400 hover:text-red-500 font-bold text-lg transition';
                    rowPanel.append(gradeSelect, removeBtn);
                    container.appendChild(rowPanel);
                    const rowData = { gradeSelect, rowPanel };
                    list.push(rowData);
                    gradeSelect.addEventListener('input', () => this.saveState());
                    removeBtn.onclick = () => {
                        container.removeChild(rowPanel);
                        list.splice(list.indexOf(rowData), 1);
                        this.saveState();
                    };
                },
                calculate() {
                    const calcMode = document.querySelector('input[name="calc-mode"]:checked')?.value || 'median';
                    const currentMapping = coursesGradeMappings[calcMode];
                    const calcSemesterAvg = (inputs) => {
                        const grades = inputs.map(input => currentMapping[input.gradeSelect.value]).filter(grade => grade !== undefined && grade !== 0);
                        return grades.length > 0 ? grades.reduce((a, b) => a + b, 0) / grades.length : 0;
                    };
                    const avg1 = calcSemesterAvg(this.s1Inputs);
                    const avg2 = calcSemesterAvg(this.s2Inputs);
                    animateValue(this.gpaS1, parseFloat(this.gpaS1.textContent) || 0, avg1, 500);
                    animateValue(this.gpaS2, parseFloat(this.gpaS2.textContent) || 0, avg2, 500);
                    let yearlyAvg = (avg1 > 0 && avg2 > 0) ? (avg1 + avg2) / 2 : (avg1 || avg2);
                    const descriptiveGrade = gradeTable.find(g => yearlyAvg >= g.min) || { name: 'N/A' };
                    animateValue(this.gpaYearly, parseFloat(this.gpaYearly.textContent) || 0, yearlyAvg, 500);
                    animateText(this.gradeName, descriptiveGrade.name);
                    notifyCalculation('courses', { 'gpa': yearlyAvg.toFixed(2), 'grade': descriptiveGrade.name });
                },
                reset() {
                    this.s1Container.innerHTML = ''; this.s2Container.innerHTML = '';
                    this.s1Inputs = []; this.s2Inputs = [];
                    this.renderInitialRows();
                    this.gpaS1.textContent = "0.00"; this.gpaS2.textContent = "0.00";
                    this.gpaYearly.textContent = "0.00"; this.gradeName.textContent = "Ø§Ù„ØªÙ‚Ø¯ÙŠØ±";
                    localStorage.removeItem('coursesCalculatorState');
                    mainController.updateSaveStatus("ØªÙ… Ø§Ù„Ù…Ø³Ø­");
                },
                saveState() {
                    const stateToSave = {
                        s1: this.s1Inputs.map(input => ({ gradeValue: input.gradeSelect.value })),
                        s2: this.s2Inputs.map(input => ({ gradeValue: input.gradeSelect.value }))
                    };
                    localStorage.setItem('coursesCalculatorState', JSON.stringify(stateToSave));
                    mainController.updateSaveStatus();
                },
                loadState() {
                    const savedState = localStorage.getItem('coursesCalculatorState');
                    if (savedState) {
                        const state = JSON.parse(savedState);
                        this.s1Container.innerHTML = ''; this.s1Inputs = [];
                        (state.s1 || []).forEach(data => this.addRow(this.s1Container, this.s1Inputs, data));
                        this.s2Container.innerHTML = ''; this.s2Inputs = [];
                        (state.s2 || []).forEach(data => this.addRow(this.s2Container, this.s2Inputs, data));
                    } else {
                        this.renderInitialRows();
                    }
                },
                renderInitialRows() {
                    if (this.s1Inputs.length === 0) for (let i = 0; i < 5; i++) this.addRow(this.s1Container, this.s1Inputs);
                    if (this.s2Inputs.length === 0) for (let i = 0; i < 5; i++) this.addRow(this.s2Container, this.s2Inputs);
                }
            }
        });

        const semesterCalculator = createBaseCalculator({
            properties: { s1Inputs: [], s2Inputs: [], termsCheckboxId: 'bologna-terms-checkbox' },
            dom: [
                 {name: 's1Container', id: 'bologna-s1-container'},
                 {name: 's2Container', id: 'bologna-s2-container'},
                 {name: 'addBtnS1', id: 'add-course-bologna-s1'},
                 {name: 'addBtnS2', id: 'add-course-bologna-s2'},
                 {name: 'calculateBtn', id: 'calculate-bologna-btn'},
                 {name: 'clearBtn', id: 'clear-bologna-btn'},
                 {name: 'gpaSemester1', id: 'gpa-bologna-s1'},
                 {name: 'gpaSemester2', id: 'gpa-bologna-s2'},
                 {name: 'gpaYearly', id: 'gpa-bologna-yearly'},
            ],
            methods: {
                addRow(container, list, data = {}) {
                    const rowPanel = document.createElement('div');
                    rowPanel.className = 'bg-slate-900/50 light-theme:bg-slate-100 p-3 rounded-lg flex items-center gap-2 animate-fade-in';
                    rowPanel.dataset.inputType = data.type || 'numeric';

                    const inputWrapper = document.createElement('div');
                    inputWrapper.className = "flex-grow flex items-center gap-2 justify-end";
                    
                    const gradeInput = document.createElement('input');
                    gradeInput.type = 'number'; gradeInput.placeholder = "Ø§Ù„Ø¯Ø±Ø¬Ø©";
                    gradeInput.className = 'w-24 input-field p-2 rounded-md text-sm text-center';
                    gradeInput.value = data.gradeValue || ''; gradeInput.min = "0"; gradeInput.max = "100";
                    
                    const gradeSelect = document.createElement('select');
                    gradeSelect.className = 'w-24 input-field p-2 rounded-md text-sm hidden';
                    Object.keys(descriptiveGradeMapping).forEach(key => {
                        const option = document.createElement('option');
                        option.value = key; option.textContent = key;
                        gradeSelect.appendChild(option);
                    });
                    gradeSelect.value = data.gradeValue || "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
                    
                    const ectsInput = document.createElement('input');
                    ectsInput.type = 'number'; ectsInput.placeholder = "Ø§Ù„ÙˆØ­Ø¯Ø§Øª";
                    ectsInput.className = 'w-20 input-field p-2 rounded-md text-sm text-center';
                    ectsInput.value = data.ectsValue || ''; ectsInput.min = "1";

                    if (rowPanel.dataset.inputType === 'descriptive') gradeInput.classList.add('hidden');
                    else gradeSelect.classList.add('hidden');
                    
                    const toggleBtn = document.createElement('button');
                    toggleBtn.innerHTML = 'ğŸ”„'; toggleBtn.title = "ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø¯Ø±Ø¬Ø© ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±";
                    toggleBtn.className = 'text-slate-400 hover:text-sky-400 transition text-lg';
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = 'âœ•'; removeBtn.title = "Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø©";
                    removeBtn.className = 'text-red-400 hover:text-red-500 font-bold text-xl transition';
                    
                    inputWrapper.append(gradeInput, gradeSelect, ectsInput, toggleBtn);
                    rowPanel.append(inputWrapper, removeBtn);
                    container.appendChild(rowPanel);

                    const rowData = { gradeInput, gradeSelect, ectsInput, rowPanel };
                    list.push(rowData);
                    
                    [gradeInput, gradeSelect, ectsInput].forEach(el => el.addEventListener('input', () => this.saveState()));

                    toggleBtn.onclick = () => {
                        const isNumeric = rowPanel.dataset.inputType === 'numeric';
                        rowPanel.dataset.numericValue = gradeInput.value;
                        gradeInput.classList.toggle('hidden', isNumeric);
                        gradeSelect.classList.toggle('hidden', !isNumeric);
                        rowPanel.dataset.inputType = isNumeric ? 'descriptive' : 'numeric';
                        this.saveState();
                    };

                    removeBtn.onclick = () => {
                        container.removeChild(rowPanel);
                        list.splice(list.indexOf(rowData), 1);
                        this.saveState();
                    };
                },
                calculate() {
                    const calcSemester = (inputs) => {
                        let totalPoints = 0, totalEcts = 0;
                        inputs.forEach(input => {
                            let grade = 0;
                            if (input.rowPanel.dataset.inputType === 'numeric') {
                                grade = parseFloat(input.gradeInput.value) || 0;
                            } else {
                                grade = descriptiveGradeMapping[input.gradeSelect.value] || 0;
                            }
                            const ects = parseFloat(input.ectsInput.value) || 0;
                            if (grade > 0 && ects > 0) {
                                totalPoints += grade * ects; totalEcts += ects;
                            }
                        });
                        return { gpa: (totalEcts > 0) ? (totalPoints / totalEcts) : 0, totalPoints, totalEcts };
                    };
                    
                    const res1 = calcSemester(this.s1Inputs);
                    const res2 = calcSemester(this.s2Inputs);
                    
                    animateValue(this.gpaSemester1, parseFloat(this.gpaSemester1.textContent) || 0, res1.gpa, 500);
                    animateValue(this.gpaSemester2, parseFloat(this.gpaSemester2.textContent) || 0, res2.gpa, 500);

                    const totalYearPoints = res1.totalPoints + res2.totalPoints;
                    const totalYearEcts = res1.totalEcts + res2.totalEcts;
                    const yearlyAverage = (totalYearEcts > 0) ? (totalYearPoints / totalYearEcts) : 0;
                    animateValue(this.gpaYearly, parseFloat(this.gpaYearly.textContent) || 0, yearlyAverage, 500);
                    
                    notifyCalculation('bologna', {'gpa': yearlyAverage.toFixed(2)});
                },
                reset() {
                    this.s1Container.innerHTML = ''; this.s2Container.innerHTML = '';
                    this.s1Inputs = []; this.s2Inputs = [];
                    this.renderInitialRows();
                    this.gpaSemester1.textContent = "0.00"; this.gpaSemester2.textContent = "0.00";
                    this.gpaYearly.textContent = "0.00";
                    localStorage.removeItem('bolognaCalculatorState');
                    mainController.updateSaveStatus("ØªÙ… Ø§Ù„Ù…Ø³Ø­");
                },
                saveState() {
                    const stateToSave = {
                        s1: this.s1Inputs.map(input => ({ type: input.rowPanel.dataset.inputType, gradeValue: input.rowPanel.dataset.inputType === 'numeric' ? input.gradeInput.value : input.gradeSelect.value, ectsValue: input.ectsInput.value })),
                        s2: this.s2Inputs.map(input => ({ type: input.rowPanel.dataset.inputType, gradeValue: input.rowPanel.dataset.inputType === 'numeric' ? input.gradeInput.value : input.gradeSelect.value, ectsValue: input.ectsInput.value }))
                    };
                    localStorage.setItem('bolognaCalculatorState', JSON.stringify(stateToSave));
                    mainController.updateSaveStatus();
                },
                loadState() {
                    const savedState = localStorage.getItem('bolognaCalculatorState');
                    if (savedState) {
                        const state = JSON.parse(savedState);
                        this.s1Container.innerHTML = ''; this.s1Inputs = [];
                        (state.s1 || []).forEach(data => this.addRow(this.s1Container, this.s1Inputs, data));
                        this.s2Container.innerHTML = ''; this.s2Inputs = [];
                        (state.s2 || []).forEach(data => this.addRow(this.s2Container, this.s2Inputs, data));
                    } else {
                        this.renderInitialRows();
                    }
                },
                renderInitialRows() {
                    if (this.s1Inputs.length === 0) for (let i = 0; i < 5; i++) this.addRow(this.s1Container, this.s1Inputs);
                    if (this.s2Inputs.length === 0) for (let i = 0; i < 5; i++) this.addRow(this.s2Container, this.s2Inputs);
                }
            }
        });
        
        const graduationCalculator = createBaseCalculator({
            properties: { yearInputs: [] },
            dom: [
                 {name: 'durationSelect', id: 'study-duration'},
                 {name: 'inputsContainer', id: 'yearly-inputs-container'},
                 {name: 'calculateBtn', id: 'calculate-graduation-btn'},
                 {name: 'clearBtn', id: 'clear-graduation-btn'},
                 {name: 'gpaLabel', id: 'gpa-graduation'},
                 {name: 'gradeNameLabel', id: 'grade-name-graduation'}
            ],
            methods: {
                renderYearInputs(savedValues = []) {
                    this.inputsContainer.innerHTML = '';
                    this.yearInputs = [];
                    const duration = this.durationSelect.value;
                    if (!duration || duration === "0") return;

                    const weights = graduationWeights[duration];
                    weights.forEach((weight, index) => {
                        const yearNum = index + 1;
                        const percentage = (weight * 100).toFixed(0);
                        const row = document.createElement('div');
                        row.className = 'flex items-center gap-3 animate-fade-in';
                        const label = document.createElement('label');
                        label.textContent = `Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†Ø© ${yearNum} (Ø¨Ù†Ø³Ø¨Ø© ${percentage}%):`;
                        label.className = 'w-1/2 text-primary';
                        const input = document.createElement('input');
                        input.type = 'number'; input.min = "0"; input.max = "100";
                        input.placeholder = "0.00"; input.className = 'w-1/2 input-field p-2 rounded-md text-center';
                        input.value = savedValues[index] || '';
                        input.addEventListener('input', () => this.saveState());
                        row.append(label, input);
                        this.inputsContainer.appendChild(row);
                        this.yearInputs.push(input);
                    });
                },
                calculate() {
                    const duration = this.durationSelect.value;
                    if (!duration || duration === "0") {
                        showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.", 'error');
                        return;
                    }
                    const weights = graduationWeights[duration];
                    let finalAverage = 0;
                    let emptyInputsCount = 0;
                    this.yearInputs.forEach((input, index) => {
                        const yearAvg = parseFloat(input.value);
                        if (isNaN(yearAvg) || input.value.trim() === '') {
                           emptyInputsCount++;
                        } else {
                           finalAverage += yearAvg * weights[index];
                        }
                    });
                     if (emptyInputsCount > 0) {
                        showToast(`Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø¯Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ù†ÙˆØ§Øª. ÙŠÙˆØ¬Ø¯ ${emptyInputsCount} Ø³Ù†Ø© Ø¨Ø¯ÙˆÙ† Ù…Ø¹Ø¯Ù„.`, 'error');
                        return;
                    }
                    const descriptiveGrade = gradeTable.find(g => finalAverage >= g.min) || { name: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' };
                    animateValue(this.gpaLabel, parseFloat(this.gpaLabel.textContent) || 0, finalAverage, 800);
                    animateText(this.gradeNameLabel, descriptiveGrade.name);
                    notifyCalculation('graduation', {'gpa': finalAverage.toFixed(2), 'grade': descriptiveGrade.name});
                },
                reset() {
                    this.durationSelect.value = "0";
                    this.inputsContainer.innerHTML = '';
                    this.yearInputs = [];
                    this.gpaLabel.textContent = "0.00";
                    this.gradeNameLabel.textContent = "Ø§Ù„ØªÙ‚Ø¯ÙŠØ±";
                    localStorage.removeItem('graduationCalculatorState');
                    mainController.updateSaveStatus("ØªÙ… Ø§Ù„Ù…Ø³Ø­");
                },
                saveState() {
                    const stateToSave = {
                        duration: this.durationSelect.value,
                        values: this.yearInputs.map(input => input.value)
                    };
                    localStorage.setItem('graduationCalculatorState', JSON.stringify(stateToSave));
                    mainController.updateSaveStatus();
                },
                loadState() {
                    const savedState = localStorage.getItem('graduationCalculatorState');
                    const select = this.durationSelect;
                    select.innerHTML = '<option value="0">-- Ø§Ø®ØªØ± --</option>';
                    Object.keys(graduationWeights).forEach(key => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = key === "6" ? "Ù¦ Ø³Ù†ÙˆØ§Øª (ÙƒÙ„ÙŠØ© Ø§Ù„Ø·Ø¨)" : `${key} Ø³Ù†ÙˆØ§Øª`;
                        if(key === "2") option.textContent = "Ø³Ù†ØªØ§Ù†";
                        select.appendChild(option);
                    });

                    if (savedState) {
                        const state = JSON.parse(savedState);
                        this.durationSelect.value = state.duration || "0";
                        this.renderYearInputs(state.values || []);
                    }
                }
            }
        });

        // --- MAIN CONTROLLER ---

        const mainController = {
            init() {
                this.cacheDOM();
                this.bindEvents();
                this.applyInitialTheme();
                coursesCalculator.init();
                semesterCalculator.init();
                graduationCalculator.init();
            },
            cacheDOM() {
                this.tabs = document.querySelectorAll('.tab');
                this.tabContents = document.querySelectorAll('.tab-content');
                this.saveStatus = document.getElementById('save-status');
                this.printModal = document.getElementById('print-modal');
                this.proceedPrintBtn = document.getElementById('proceed-print-btn');
                this.cancelPrintBtn = document.getElementById('cancel-print-btn');
                this.universityNameInput = document.getElementById('university-name-input');
                this.collegeNameInput = document.getElementById('college-name-input');
                this.studentNameInput = document.getElementById('student-name-input');
                this.themeSwitcher = document.getElementById('theme-switcher');
                this.themeIconDark = document.getElementById('theme-icon-dark');
                this.themeIconLight = document.getElementById('theme-icon-light');
                this.activeTab = 'courses';
            },
            bindEvents() {
                this.tabs.forEach(tab => {
                    tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
                });
                
                // Create and bind print button
                let printBtn = document.getElementById('print-btn');
                if (!printBtn) {
                    printBtn = document.createElement('button');
                    printBtn.id = 'print-btn';
                    printBtn.className = 'fixed bottom-5 left-5 bg-sky-500 text-white p-4 rounded-full shadow-lg z-40 hover:bg-sky-600 transition transform hover:scale-110';
                    printBtn.title = 'Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±';
                    printBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>';
                    document.body.appendChild(printBtn);
                }
                printBtn.addEventListener('click', () => this.openPrintModal());
                
                this.cancelPrintBtn.addEventListener('click', () => this.printModal.classList.add('hidden'));
                this.proceedPrintBtn.addEventListener('click', () => this.printReport());
                this.themeSwitcher.addEventListener('click', () => this.toggleTheme());
            },
            applyInitialTheme() {
                const savedTheme = localStorage.getItem('theme') || 'dark';
                this.setTheme(savedTheme);
            },
            toggleTheme() {
                const newTheme = document.body.classList.contains('light-theme') ? 'dark' : 'light';
                this.setTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            },
            setTheme(theme) {
                document.body.classList.toggle('light-theme', theme === 'light');
                this.themeIconDark.classList.toggle('hidden', theme === 'light');
                this.themeIconLight.classList.toggle('hidden', theme === 'dark');
            },
            switchTab(activeTab) {
                this.activeTab = activeTab;
                this.tabs.forEach(tab => tab.classList.toggle('active', tab.dataset.tab === activeTab));
                this.tabContents.forEach(content => content.classList.toggle('hidden', content.id !== `tab-content-${activeTab}`));
            },
            openPrintModal() {
                let gpa = 0;
                if (this.activeTab === 'bologna') gpa = parseFloat(semesterCalculator.gpaYearly.textContent);
                else if(this.activeTab === 'courses') gpa = parseFloat(coursesCalculator.gpaYearly.textContent);
                else gpa = parseFloat(graduationCalculator.gpaLabel.textContent);

                if (isNaN(gpa) || gpa === 0) {
                    showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø¯Ù„ ØµØ§Ù„Ø­ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©.", 'error');
                    return;
                }
                this.printModal.classList.remove('hidden');
            },
            printReport() {
                const university = this.universityNameInput.value || "Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©";
                const college = this.collegeNameInput.value || "Ø§Ù„ÙƒÙ„ÙŠØ© / Ø§Ù„Ù‚Ø³Ù…";
                const student = this.studentNameInput.value || "Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨";
                let title, gpa, grade, detailsHtml;

                if (this.activeTab === 'courses') {
                     title = "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ (Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª)";
                     gpa = coursesCalculator.gpaYearly.textContent;
                     grade = coursesCalculator.gradeName.textContent;
                     detailsHtml = `<div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-slate-200 rounded-md"><strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„:</strong> <span class="font-bold text-lg">${coursesCalculator.gpaS1.textContent}</span></div>
                            <div class="p-4 bg-slate-200 rounded-md"><strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ:</strong> <span class="font-bold text-lg">${coursesCalculator.gpaS2.textContent}</span></div>
                        </div>`;
                } else if (this.activeTab === 'bologna') {
                    title = "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ (Ù†Ø¸Ø§Ù… Ø¨ÙˆÙ„ÙˆÙ†ÙŠØ§)";
                    gpa = semesterCalculator.gpaYearly.textContent;
                    grade = gradeTable.find(g => parseFloat(gpa) >= g.min)?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    detailsHtml = `<div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-slate-200 rounded-md"><strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„:</strong> <span class="font-bold text-lg">${semesterCalculator.gpaSemester1.textContent}</span></div>
                            <div class="p-4 bg-slate-200 rounded-md"><strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ:</strong> <span class="font-bold text-lg">${semesterCalculator.gpaSemester2.textContent}</span></div>
                        </div>`;
                } else {
                    title = "ØªÙ‚Ø±ÙŠØ± Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ®Ø±Ø¬";
                    gpa = graduationCalculator.gpaLabel.textContent;
                    grade = graduationCalculator.gradeNameLabel.textContent;
                    detailsHtml = graduationCalculator.yearInputs.map((input, index) => {
                         const yearNum = index + 1;
                         const weight = (graduationWeights[graduationCalculator.durationSelect.value][index] * 100).toFixed(0);
                         return `<div class="p-2"><strong>Ø§Ù„Ø³Ù†Ø© ${yearNum} (${weight}%):</strong> ${parseFloat(input.value || 0).toFixed(2)}</div>`;
                    }).join('');
                    detailsHtml = `<div class="grid grid-cols-2 gap-4">${detailsHtml}</div>`;
                }

                const printContent = `
                    <html><head><title>${title}</title>
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
                    <style>body{font-family:'Cairo',sans-serif;background-color:white;color:black;}.print-container{max-width:800px;margin:auto;padding:40px;border:1px solid #e2e8f0;position:relative;}.watermark{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);font-size:6rem;color:rgba(0,0,0,0.05);z-index:-1;pointer-events:none;font-weight:bold;white-space:nowrap;}@media print{.no-print{display:none;}body{-webkit-print-color-adjust:exact;}}</style>
                    </head><body dir="rtl"><div class="print-container">
                    <div class="watermark">ÙˆØ«ÙŠÙ‚Ø© ØºÙŠØ± Ø±Ø³Ù…ÙŠØ©</div>
                    <header class="text-center mb-10 border-b-2 border-gray-300 pb-4"><h1 class="text-3xl font-bold">${university}</h1><h2 class="text-xl text-gray-600">${college}</h2></header>
                    <main><h3 class="text-2xl font-bold mb-6">${title}</h3>
                    <div class="grid grid-cols-2 gap-6 mb-8 text-md"><div><strong>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> ${student}</div><div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> ${new Date().toLocaleDateString('ar-EG')}</div></div>
                    <div class="bg-sky-50 text-sky-800 rounded-xl p-8 text-center mb-8"><p class="text-lg">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p><p class="text-7xl font-black">${gpa}</p><p class="text-2xl font-bold mt-2">${grade}</p></div>
                    <h4 class="font-bold text-lg mb-4">Ø§Ù„ØªÙØ§ØµÙŠÙ„:</h4><div class="text-md text-gray-700">${detailsHtml}</div></main>
                    <footer class="text-center mt-12 text-xs text-gray-400 pt-4 border-t">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… GradeMaster Pro | Ø¨Ø±Ù…Ø¬Ø©: Ahmed S.Jabbar</footer>
                    </div><button onclick="window.print()" class="no-print fixed bottom-5 right-5 bg-sky-500 text-white p-4 rounded-full shadow-lg">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                    </body></html>`;

                const printWindow = window.open('', '', 'height=800,width=800');
                printWindow.document.write(printContent);
                printWindow.document.close();
                printWindow.focus();
                this.printModal.classList.add('hidden');
            },
            updateSaveStatus(message = 'ØªÙ… Ø§Ù„Ø­ÙØ¸') {
                const now = new Date();
                if(this.saveStatus) {
                   this.saveStatus.textContent = `${message} ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                   this.saveStatus.style.opacity = '1';
                   setTimeout(() => { if (this.saveStatus) this.saveStatus.style.opacity = '0.7' }, 2000);
                }
            }
        };
        
        // Initialize the application
        mainController.init();
    });
    </script>
</body>
</html>
